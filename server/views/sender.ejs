<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />
    <link rel="stylesheet" href="http://0.0.0.0:9000/style.css">
    <title>Shit Going Down</title>
    <script type="application/javascript">
      function sendMsg(phone, coords, fbData, err) {
        document.body.append(`<div>${JSON.stringify(localStorage)}</div>`);
        fetch('/sms/send', {
          method: "POST",
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            phone,
            coords,
            fbData,
            err})
        }).then(resp => {
          if (!resp.ok) {
            console.log('something went wrong: ', resp)
          } else {
            return resp.json();
          }
        }).then(data => {
          console.log(data);
        });

      }
      window.onload = () => {
        const button = document.querySelector('button');
        button.addEventListener('click', (ev) => {
          ev.preventDefault();
          console.log(window.localStorage.getItem('sgdPhone'));
          const phone = window.localStorage.getItem('sgdPhone');
          const fbId = localStorage.getItem('sgdFbId');
          const fbName = localStorage.getItem('sgdName');
          if ('geolocation' in navigator) {
            navigator.geolocation.getCurrentPosition(result => {
              const { latitude, longitude } = result.coords;
              sendMsg(phone, { latitude, longitude }, { fbId, fbName });
            }, err => {
              console.log(err);
              sendMsg(phone, null, { fbId, fbName }, err.message);
            }, {maximumAge:60000, timeout:5000})
          } else {
            sendMsg(phone, null, { fbId, fbName });
          }
        });
      }
    </script>
  </head>
  <body>
    <div class="generalpage sms">
      <div class="nav">
        <div class="upButtons">
          <a class="goBackEnd" href="#">Â« back</a>
          <a class="logo" href="https://www.shitgoingdown.com">www.shitgoingdown.com</a>
        </div>
      </div>
      <div class="smsCointainer">
        <div class='smsPage'>
          <h2 class="safe sms">stay safe</h2>
          <div class='centerSMS'>
            <div class='smsDiv real'>
              <button class="SMS real">SMS</br> your </br> trusted </br> friends</button>
            </div>
          </div>
          <p class='loginInstructionTwo sms'>
          This message is being sent on behalf of Robert Drake Talley
          Please notify my friends. You can use this link:
          to see where I was around when I sent this message: https://maps.google.com/?q=40.719494,-73.9886672
          </p>
        </div>
      </div>
    </div>
  </body>
</html>
